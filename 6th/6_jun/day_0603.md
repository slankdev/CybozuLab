

## Jun 3 (Fri) 2016

### 今日の予定

 - VM環境でパケット送信がうまくいくかをしらべる (0.5h)
 - DPDKをC++から呼び出す方法の調査 (1.5h)
 - NW機器APIの設計 (長期目標だった奴です) (3.0h)



### 今日やった内容

 - VM環境でパケット送信がうまくいくかをしらべる (0.5h)
   VM環境では問題なくパケットを送信することができた。
   また、Thinkpad環境からでも問題なくパケットを送信することができたので、
   やはり問題はデスクトップ機にあるのかもしれない。
   次回火曜日に一度デスクトップ機のセットアップをしなおしてみることにした。
 - DPDKをC++から呼び出す方法の調査 (2.5h)
   DPDKの提供しているMakefileの雛形をいままで使ってきたが、
   実際に開発されているアプリケーションでは雛形を使用していないことが多い
   様なので、その方向でしらべたが、今ひとつ解決しなかった。
   dpdk-sdk内部のmakefileを一部編集することでC++から呼び出せるように
   なるっぽい。
   また、C++で使えない文法(struct str = { .a = 10};)みたいなのを
   実装がわでうまくまとめなくてはならなさそう。
 - misclibの整理 (1.5h) -> サンプルとして簡単なバカハブを実装
 - NW機器APIの設計 (0.5h)
   miscライブラリの整理をしました。pollfdを簡単にラップしているクラスが
   あるので、それを改良していこうと思います。
   全体的に開発を始める前に、misclibを手直ししておきます。 



### デスクトップマシンからパケットが送信できない問題について

以下の環境では特別にパケットの送信が行える。

 - pktgenでは正常にパケットが送信できる。
 - gdbでrte_eth_tx_burstにstep実行すると成功する -> これほんとなんなんだよ。。
   ちなみにブレークポイントを仕掛けないでそのまま実行するとうまくいかない模様。
   ブレークして、nとsで進んで行った場合のみパケットを送ることができる。 



### 次回の予定

 - デスクトップマシンの再セットアップ
   OSに問題がなければ、HWの問題なのかなあ。。(涙)
 - パケット受信時にコールバック関数を呼び出す機能を設計実装



### 問題点,原因,対策 (それぞれ1,2,3で分けて書く)

得になし。
朝、電車で寝過ごして、折り返して自宅の方に戻って行ってしまったので、気をつけるくらい。



### 感想 (あれば)

久しぶりにDPDK以外を触ってなんだかリフレッシュした。
うまく動いてくれないつらみが今日はほとんどなかった。。



### Commits

***libslankdev***
https://github.com/slankdev/libslankdev

 - [ADD, RENAME] add namespace slankdev, rename class base->pollfd
   https://github.com/slankdev/libslankdev/commit/f80b24363b9769df75bfbb105010c9eeb1da9836
 - [ADD] sample l2_hub
   https://github.com/slankdev/libslankdev/commit/0f288aff53163cb944bd9e954cf98264978f1ac1

 - Sampleバカハブ
   https://github.com/slankdev/libslankdev/tree/master/sample/l2_hub


