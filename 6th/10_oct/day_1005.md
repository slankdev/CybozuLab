

[サイボウズ・ラボユース日時報告書]
---------------------------------------------------------------------------
勤務日：2016年10月05日水曜日
報告者：城倉弘樹
---------------------------------------------------------------------------
###■ 開発プロジェクト名
 slankdev/stcp.git

###■ 今日の目標

 - ICMPモジュールに問題があったためそれの修正 1h
 - IPフラグメンテーションの実装 3.0h

###■ 作業実績 (実際にかかった時間を書いてください)

 - 10:00-11:30 ICMPモジュールの問題発見、その修正
 - 11:30-  IPフラグメンテーションの実装パターンに関しての情報収集

###■ 達成度

50%

 - バグ修正と情報収集で時間がなくなってしまった。。

 - 恥ずかしながら、自分でフラグメンテーションの部分を実装したり解析したことがあまり
   なかったため、まずsocketでデータをフラグメントさせて送るプログラムを書いてから
   挙動をみた。
 - 実装する内容はわかったので,賢い実装パターンをDPDKのドキュメントを見ながら
   勉強した。


###■ 問題点,原因,対策 (それぞれ1,2,3で分けて書く)


 - prefetcheってことばが最近ドキュメントをみているとでてくるように
   なったが、これの意味がいまいち解らない。。

 - ICMPのchecksumの計算方法に問題があったみたいで、
   とりあえずネットにあったソースをコピったら治った。。
   いままで使いまわしていたchecksumのコードなので、
   これは今後直しておかないといけなさそう。。

 - DPDKのドキュメントは色々なことに対する資料が整っていて、勉強になるなあと感じた
 - 僕も用語の使い方 IPとipとかをしっかり区別して使う (明日から)

 - 来年度の未踏事業の公募がはじまってテーマ選択に時間を
   燃やしていたら体調が悪くなった。(心の体調(笑))


###■ 明日以降の予定

 - rte_ipv4_fragment_packet()を使ってIPフラグメンテーション機能をIPモジュールに追加する
 - 次回勤務時間内にフラグメンテーションを利用した送信は絶対に出きるようにする


###■ 作業リポジトリ履歴

slankdev/stcp
 - [FIX] #20 calculation of checksum
   http://github.com/slankdev/stcp/commit/1598c1e6adc416f58913a8e5b21fe2b1aaf3bdeb

今後使う予定のAPI
 - DPDKのIPv4フラグメンテーション用のAPI -> 今回はこれを使う
   http://dpdk.org/doc/api/rte__ip__frag_8h.html#a0ec59118790a4babb24bd5636b1e60d9
 - DPDKのIPv4デフラグメンテーション用のAPI
   http://dpdk.org/doc/api/rte__ip__frag_8h.html#a6a861ef2cc70e5d1f09c33851c6627d9

その他
 - DPDKでのIPフラグメンテーションのサンプルアプリケーション
   これはフラグメントしたパケットをキューに貯めて、タイマをつかってすこしずつパケットを
   出している実装だった。 307行目付近を読み見て理解する
   STCPではフラグメント用キューを用意してそれをip::proc()ごとにすこしずつ送っていく実装に
   するよてい。(タイマの実装はしていないし、そういうのを使わないで実装したい)
   http://dpdk.org/doc/guides/sample_app_ug/ip_frag.html
   http://dpdk.org/doc/api/ip_fragmentation_2main_8c-example.html
 - IPフラグメンテーションを有効にしたソケットのサンプルコード
   https://gist.github.com/slankdev/fb46807b8ff4c2682638cbbc3e7a26f5
 - icmpのチェックサム問題について -> その場しのぎなのであとでなおす
   https://github.com/slankdev/stcp/issues/20

---------------------------------------------------------------------------
